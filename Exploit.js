/** @param {NS} ns */

export async function main(ns){
    var targets = ns.scan(ns.getHostname());

    while(true){
      for(var target of targets){
          if(ns.hasRootAccess(target)){
              var money = ns.getServerMoneyAvailable(target);
              var security = ns.getServerSecurityLevel(target);

              while(money > 1){
                  if(security > 1){
                      await ns.weaken(target);
                      ns.print(" Avant weaken : " + security);
                      security -= ns.getServerSecurityLevel(target);
                      ns.print(" Apres weaken : " + security);
                  }
                  if(ns.getServerMaxMoney(target) > ns.getServerMoneyAvailable(target)){
                      await ns.grow(target);
                      ns.print(" Avant grow : " + money);
                      money -= ns.getServerMoneyAvailable(target);
                      ns.print(" Apres grow : " + money);
                  }
                  await ns.hack(target);
              }
          }
      }

      ns.print("Done");
      ns.print("Restarting...");
    }
}